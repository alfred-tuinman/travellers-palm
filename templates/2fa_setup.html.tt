<!DOCTYPE html>
<html>
<head>
    <title>Two-Factor Authentication Setup - Travellers Palm</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .container { background: #f9f9f9; padding: 30px; border-radius: 10px; }
        .qr-code { text-align: center; margin: 20px 0; }
        .secret-key { background: #e8e8e8; padding: 15px; margin: 10px 0; font-family: monospace; word-break: break-all; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { padding: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #0056b3; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .alert { padding: 15px; margin: 20px 0; border-radius: 5px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Two-Factor Authentication (2FA)</h1>
        
        [% IF success %]
            <div class="alert alert-success">[% success %]</div>
        [% END %]
        
        [% IF error %]
            <div class="alert alert-error">[% error %]</div>
        [% END %]
        
        [% IF has_2fa %]
            <div class="alert alert-success">
                <strong>2FA is currently ENABLED</strong> for your account.
            </div>
            
            <form method="POST" action="/2fa/disable">
                <button type="submit" class="btn-danger" onclick="return confirm('Are you sure you want to disable 2FA?')">
                    Disable 2FA
                </button>
            </form>
        [% ELSE %]
            <div class="alert alert-error">
                <strong>2FA is currently DISABLED</strong> for your account.
            </div>
            
            <h2>Enable Two-Factor Authentication</h2>
            
            <div class="step">
                <h3>Step 1: Install an Authenticator App</h3>
                <p>Download one of these apps on your phone:</p>
                <ul>
                    <li><strong>Google Authenticator</strong> (iOS/Android)</li>
                    <li><strong>Authy</strong> (iOS/Android/Desktop)</li>
                    <li><strong>Microsoft Authenticator</strong> (iOS/Android)</li>
                </ul>
            </div>
            
            <div class="step">
                <h3>Step 2: Scan QR Code</h3>
                <p>Open your authenticator app and scan this QR code:</p>
                <div class="qr-code">
                    <img src="/2fa/qr" alt="2FA QR Code" />
                </div>
                <p><small>Can't scan? You can manually enter this secret key into your app:</small></p>
                <div class="secret-key" id="secret-key">Loading secret key...</div>
            </div>
            
            <div class="step">
                <h3>Step 3: Verify Setup</h3>
                <p>Enter the 6-digit code from your authenticator app:</p>
                
                <form method="POST" action="/2fa/enable">
                    <div class="form-group">
                        <label for="verification_code">Verification Code:</label>
                        <input type="text" 
                               id="verification_code" 
                               name="verification_code" 
                               maxlength="6" 
                               pattern="[0-9]{6}" 
                               placeholder="000000"
                               required>
                    </div>
                    <button type="submit">Enable 2FA</button>
                </form>
            </div>
        [% END %]
        
        <div style="margin-top: 30px; text-align: center;">
            <a href="/login">‚Üê Back to Login</a>
        </div>
    </div>
    
    <script>
        // Auto-format the verification code input
        document.getElementById('verification_code')?.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>