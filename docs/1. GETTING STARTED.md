# Getting Started

Welcome to Travellers Palm! This guide will help you get the application running locally for development.

## Quick Start

### Option 1: Local Development (Recommended)

```bash
# Install Carton (Perl package manager)
cpanm --notest Carton

# Install dependencies
carton install --without=develop

# Start development server with hot reload
carton exec -- morbo -l http://*:3000 script/travellers_palm
```

Visit `http://localhost:3000` to see the application.

### Option 2: Docker Development

```bash
# Build and start with Docker Compose
docker-compose up --build

# For faster restarts after initial build
./restart.sh --no-build
```

## Prerequisites

### System Requirements
- **Operating System**: Linux, macOS, or Windows with WSL
- **Perl**: Version 5.20+ (recommended 5.32+)
- **Memory**: 2GB+ RAM for development
- **Storage**: 1GB+ for application and dependencies

### Required Tools
- **Carton**: Perl dependency manager (`cpanm --notest Carton`)
- **Git**: For version control
- **Docker** (optional): For containerized development

### Optional Tools
- **Memcached**: For caching (`sudo apt-get install memcached`)
- **Docker Compose**: For multi-container development

## Installation Steps

### 1. Clone Repository
```bash
git clone <repository-url>
cd travellers_palm
```

### 2. Install Dependencies

#### Using Carton (Local Development)
```bash
# Install Carton if not already installed
cpanm --notest Carton

# Install project dependencies
carton install --without=develop

# Verify installation
carton exec -- perl -MTravellersPalm -e 'print "Dependencies OK\n"'
```

#### Using Docker
```bash
# Dependencies are installed automatically during build
docker-compose up --build
```

### 3. Database Setup

The application automatically initializes databases on first run:

```bash
# Databases are copied from localdb/ to data/ on startup
# Check initialization
ls -la data/
cat data/db_version.txt
```

### 4. Configuration

Copy and customize configuration:
```bash
# Main configuration
cp config.yml.example config.yml  # if example exists
# Edit config.yml for your environment

# Environment variables (for email, etc.)
cp .env.example .env  # if example exists
# Edit .env with your credentials
```

### 5. Start Development Server

```bash
# Start with hot reload
carton exec -- morbo -l http://*:3000 script/travellers_palm

# Or use our smart restart script
./restart.sh
```

## Verification

### Test the Installation
```bash
# Run basic tests
carton exec -- prove -lv t/01-startup.t

# Test web interface
curl http://localhost:3000/
```

### Check Components
```bash
# Check database connection
carton exec -- perl script/travellers_palm eval 'app->log->info("Database OK")'

# Check email configuration (if configured)
carton exec -- perl script/test_email_connectivity.pl
```

## Development Environment

### Directory Structure
After setup, your directory should look like:
```
travellers_palm/
â”œâ”€â”€ script/travellers_palm  # Main application entry point
â”œâ”€â”€ lib/TravellersPalm.pm   # Main application class
â”œâ”€â”€ lib/TravellersPalm/     # Application modules
â”‚   â”œâ”€â”€ Database/           # Database layer
â”‚   â”œâ”€â”€ Controller/         # Web controllers
â”‚   â”œâ”€â”€ Logger.pm           # Logging system
â”‚   â”œâ”€â”€ Mailer.pm           # Email system
â”‚   â”œâ”€â”€ Hooks.pm            # Application hooks
â”‚   â””â”€â”€ Routes.pm           # URL routing
â”œâ”€â”€ templates/              # Template Toolkit (*.tt) files
â”œâ”€â”€ public/                 # Static assets (CSS, JS, images)
â”œâ”€â”€ config.yml              # Main configuration file
â”œâ”€â”€ localdb/                # Database seed files (read-only)
â”‚   â”œâ”€â”€ cities.csv
â”‚   â”œâ”€â”€ hotels.csv
â”‚   â””â”€â”€ config/
â”œâ”€â”€ data/                   # Runtime databases (auto-created from localdb/)
â”œâ”€â”€ log/                    # Application logs
â”œâ”€â”€ local/                  # Carton dependencies
â”œâ”€â”€ carton_cache/          # Docker dependency cache
â”œâ”€â”€ t/                     # Test files
â””â”€â”€ script/                # Utility scripts
```

#### Key Components
- **Entry Point**: `script/travellers_palm` launches the Mojolicious application
- **Application Core**: `lib/TravellersPalm.pm` bootstraps all modules and services
- **Database Seeds**: `localdb/` contains CSV files that are copied to `data/` on startup
- **Templates**: Template Toolkit (`*.tt`) files in `templates/` for HTML rendering
- **Configuration**: `config.yml` manages databases, templates, memcached, and logging

### File Permissions
Ensure these directories are writable:
```bash
chmod 755 data/ log/ carton_cache/
```

## Troubleshooting

### Common Issues

#### "Module not found" errors
```bash
# Reinstall dependencies
carton install --without=develop

# Check Perl path
carton exec -- perl -V
```

#### Database initialization problems
```bash
# Check localdb/ source files exist
ls -la localdb/

# Force database re-initialization
rm data/db_version.txt
# Restart application
```

#### Port conflicts
```bash
# Use different port
carton exec -- morbo -l http://*:3001 script/travellers_palm

# Or check what's using port 3000
netstat -tulpn | grep :3000
```

#### Docker build issues
```bash
# Clean build
docker-compose down
docker-compose build --no-cache
docker-compose up
```

### Getting Help

- Check the logs: `tail -f log/travellers_palm.log.*`
- Run tests: `carton exec -- prove -lv t/`
- Verify configuration: Review `config.yml` settings
- Check dependencies: `carton list`

## Next Steps

Once you have the application running:

1. **Explore the Interface**: Visit `http://localhost:3000`
2. **Review Configuration**: See [Configuration Guide](CONFIGURATION.md)
3. **Development Workflow**: See [Development Guide](DEVELOPMENT.md)
4. **Understanding Email System**: See [Email System](EMAIL_SYSTEM.md)
5. **Database Management**: See [Database Guide](DATABASE.md)

## Development Tips

### Fast Restart Workflow
```bash
# Smart restart (checks for dependency changes)
./restart.sh

# Force rebuild
./restart.sh --build

# Skip rebuild (fastest)
./restart.sh --no-build
```

### Debugging
```bash
# Enable debug logging
MOJO_LOG_LEVEL=debug carton exec -- morbo script/travellers_palm

# Test specific functionality
carton exec -- perl script/debug_oauth2.pl
```

### Testing
```bash
# Run all tests
carton exec -- prove -lv t/

# Run specific test
carton exec -- prove -lv t/11-home.t

# Test in production-like environment
./bin/test-in-docker.sh
```

Welcome to Travellers Palm development! ðŸŒ´